2025-04-14 11:56:46,379 - direct-mcp - INFO - File logging initialized to direct_mcp_server.log
2025-04-14 11:56:46,379 - direct-mcp - INFO - Added SDK path: /home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src
2025-04-14 11:56:46,814 - direct-mcp - INFO - Successfully imported MCP and Starlette modules.
2025-04-14 11:56:46,814 - direct-mcp - INFO - Starting as BLUE instance based on active version file
2025-04-14 11:56:46,814 - direct-mcp - INFO - Wrote PID 1306397 to direct_mcp_server_blue.pid
2025-04-14 11:56:46,828 - direct-mcp - INFO - Starting Direct MCP Server (blue) on port 8000...
2025-04-14 11:56:46,828 - direct-mcp - INFO - Creating FastMCP SSE app with built-in protocol handling
2025-04-14 11:56:46,828 - direct-mcp - INFO - MCP Server Tools: ['list_files', 'deployment_status', 'edit_file', 'patch_file', 'start_blue_green_deployment', 'read_file', 'read_file_slice', 'write_file']
2025-04-14 11:56:46,828 - direct-mcp - INFO - Endpoint paths: ['/sse', '/messages', '/']
INFO:     Started server process [1306397]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     127.0.0.1:52384 - "GET /sse HTTP/1.1" 200 OK
INFO:     127.0.0.1:36364 - "GET /mcp HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:36380 - "GET /mcp HTTP/1.1" 404 Not Found
INFO:     127.0.0.1:48996 - "GET /sse HTTP/1.1" 200 OK
INFO:     127.0.0.1:49010 - "POST /messages/?session_id=ee388f93a64f418ea3e097de1b71c1fd HTTP/1.1" 202 Accepted
INFO:     127.0.0.1:49016 - "POST /messages/?session_id=ee388f93a64f418ea3e097de1b71c1fd HTTP/1.1" 202 Accepted
INFO:     127.0.0.1:49018 - "POST /messages/?session_id=ee388f93a64f418ea3e097de1b71c1fd HTTP/1.1" 202 Accepted
2025-04-15 14:07:43,630 - mcp.server.lowlevel.server - INFO - Processing request of type ListToolsRequest
2025-04-15 14:07:43,630 - mcp.server.lowlevel.server - INFO - Processing request of type ListToolsRequest
ERROR:    Exception in ASGI application
  + Exception Group Traceback (most recent call last):
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
  |     result = await app(  # type: ignore[func-returns-value]
  |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
  |     return await self.app(scope, receive, send)
  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
  |     await self.middleware_stack(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
  |     raise exc
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
  |     await self.app(scope, receive, _send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
  |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
  |     raise exc
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
  |     await app(scope, receive, sender)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
  |     await self.middleware_stack(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
  |     await route.handle(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
  |     await self.app(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
  |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
  |     raise exc
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
  |     await app(scope, receive, sender)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
  |     response = await f(request)
  |                ^^^^^^^^^^^^^^^^
  |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/fastmcp/server.py", line 485, in handle_sse
  |     async with sse.connect_sse(
  |   File "/usr/lib/python3.12/contextlib.py", line 231, in __aexit__
  |     await self.gen.athrow(value)
  |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/sse.py", line 123, in connect_sse
  |     async with anyio.create_task_group() as tg:
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Exception Group Traceback (most recent call last):
    |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/sse.py", line 131, in connect_sse
    |     yield (read_stream, write_stream)
    |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/fastmcp/server.py", line 490, in handle_sse
    |     await self._mcp_server.run(
    |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/lowlevel/server.py", line 483, in run
    |     async with AsyncExitStack() as stack:
    |   File "/usr/lib/python3.12/contextlib.py", line 754, in __aexit__
    |     raise exc_details[1]
    |   File "/usr/lib/python3.12/contextlib.py", line 737, in __aexit__
    |     cb_suppress = await cb(*exc_details)
    |                   ^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/shared/session.py", line 210, in __aexit__
    |     return await self._task_group.__aexit__(exc_type, exc_val, exc_tb)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
    |     raise BaseExceptionGroup(
    | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
    +-+---------------- 1 ----------------
      | Exception Group Traceback (most recent call last):
      |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/lowlevel/server.py", line 489, in run
      |     async with anyio.create_task_group() as tg:
      |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
      |     raise BaseExceptionGroup(
      | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
      +-+---------------- 1 ----------------
        | Traceback (most recent call last):
        |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/lowlevel/server.py", line 517, in _handle_message
        |     await self._handle_request(
        |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/lowlevel/server.py", line 563, in _handle_request
        |     await message.respond(response)
        |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/shared/session.py", line 117, in respond
        |     assert not self._completed, "Request already responded to"
        |            ^^^^^^^^^^^^^^^^^^^
        | AssertionError: Request already responded to
        +------------------------------------
INFO:     127.0.0.1:49028 - "POST /messages/?session_id=ee388f93a64f418ea3e097de1b71c1fd HTTP/1.1" 202 Accepted
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 460, in handle
    await self.app(scope, receive, send)
  File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/sse.py", line 175, in handle_post_message
    await writer.send(message)
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/anyio/streams/memory.py", line 242, in send
    self.send_nowait(item)
  File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/anyio/streams/memory.py", line 213, in send_nowait
    raise BrokenResourceError
anyio.BrokenResourceError
INFO:     127.0.0.1:58240 - "GET /sse HTTP/1.1" 200 OK
INFO:     127.0.0.1:58248 - "POST /messages/?session_id=f5735b8d0d5e49369088abf7708f283c HTTP/1.1" 202 Accepted
INFO:     127.0.0.1:58262 - "POST /messages/?session_id=f5735b8d0d5e49369088abf7708f283c HTTP/1.1" 202 Accepted
2025-04-15 14:07:48,639 - mcp.server.lowlevel.server - INFO - Processing request of type ListResourceTemplatesRequest
2025-04-15 14:07:48,640 - mcp.server.lowlevel.server - INFO - Processing request of type ListResourceTemplatesRequest
ERROR:    Exception in ASGI application
  + Exception Group Traceback (most recent call last):
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
  |     result = await app(  # type: ignore[func-returns-value]
  |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
  |     return await self.app(scope, receive, send)
  |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/applications.py", line 112, in __call__
  |     await self.middleware_stack(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 187, in __call__
  |     raise exc
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 165, in __call__
  |     await self.app(scope, receive, _send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
  |     await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
  |     raise exc
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
  |     await app(scope, receive, sender)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 714, in __call__
  |     await self.middleware_stack(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 734, in app
  |     await route.handle(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 288, in handle
  |     await self.app(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 76, in app
  |     await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
  |     raise exc
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
  |     await app(scope, receive, sender)
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/starlette/routing.py", line 73, in app
  |     response = await f(request)
  |                ^^^^^^^^^^^^^^^^
  |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/fastmcp/server.py", line 485, in handle_sse
  |     async with sse.connect_sse(
  |   File "/usr/lib/python3.12/contextlib.py", line 231, in __aexit__
  |     await self.gen.athrow(value)
  |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/sse.py", line 123, in connect_sse
  |     async with anyio.create_task_group() as tg:
  |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
  |     raise BaseExceptionGroup(
  | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
  +-+---------------- 1 ----------------
    | Exception Group Traceback (most recent call last):
    |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/sse.py", line 131, in connect_sse
    |     yield (read_stream, write_stream)
    |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/fastmcp/server.py", line 490, in handle_sse
    |     await self._mcp_server.run(
    |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/lowlevel/server.py", line 483, in run
    |     async with AsyncExitStack() as stack:
    |   File "/usr/lib/python3.12/contextlib.py", line 754, in __aexit__
    |     raise exc_details[1]
    |   File "/usr/lib/python3.12/contextlib.py", line 737, in __aexit__
    |     cb_suppress = await cb(*exc_details)
    |                   ^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/shared/session.py", line 210, in __aexit__
    |     return await self._task_group.__aexit__(exc_type, exc_val, exc_tb)
    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
    |     raise BaseExceptionGroup(
    | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
    +-+---------------- 1 ----------------
      | Exception Group Traceback (most recent call last):
      |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/lowlevel/server.py", line 489, in run
      |     async with anyio.create_task_group() as tg:
      |   File "/home/barberb/ipfs_kit_py/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 772, in __aexit__
      |     raise BaseExceptionGroup(
      | ExceptionGroup: unhandled errors in a TaskGroup (1 sub-exception)
      +-+---------------- 1 ----------------
        | Traceback (most recent call last):
        |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/lowlevel/server.py", line 517, in _handle_message
        |     await self._handle_request(
        |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/server/lowlevel/server.py", line 563, in _handle_request
        |     await message.respond(response)
        |   File "/home/barberb/ipfs_kit_py/docs/mcp-python-sdk/src/mcp/shared/session.py", line 117, in respond
        |     assert not self._completed, "Request already responded to"
        |            ^^^^^^^^^^^^^^^^^^^
        | AssertionError: Request already responded to
        +------------------------------------
INFO:     127.0.0.1:58272 - "GET /sse HTTP/1.1" 200 OK
